# Torkan 2018 - för utvecklare
Filerna på formatet `.npz` som används i uppgiften framställdes på följande sätt:

- Bilder laddades ner från [Coperinucus Open Access Hub](https://scihub.copernicus.eu/dhus/#/home) genom att markera sökt område och ställa in sökt datum. Bilderna kommer från Mission: Sentinel-2. Satellite platform lämnas blankt, detta avgör bara vilken kamera bilderna kommer ifrån. För product type användes S2MSI1C. Dessa bilderna är inte helt råa utan har redan formaterats för att lättare användas. För inställningen cloud cover valdes [0 TO 10], detta innebär att vi får upp bilder som är upp till 10% täckta av moln. Dock gör vi beskärningar av bilderna senare, och för det beskärda området är det viktigt att inga synliga moln finns eftersom det gör det svårt att få en verklig bild av NDVI. 
- Orginalnamnen där man kan se datum för fotografi och ytterligare data på de nedladdade filerna är:
    + S2A_MSIL1C_20150806T102016_N0204_R065_T33UUB_20150806T102012.SAFE
    + S2A_MSIL1C_20170815T102021_N0205_R065_T33UUB_20170815T102513.SAFE
    + S2A_MSIL1C_20180731T102021_N0206_R065_T33UUB_20180731T123616.SAFE
  
- När bilderna är nedladdade användes `gdal` för att öppna filerna genom att i `.SAFE`-directoriet köra `gdal.Open("MTD_MSIL1C.xml").GetSubDatasets()`. Detta listar alla datasets som finns i filen. Datasetet som används är det första som innehåller banden B4 och B8. Det är det röda bandet respektive det nära infraröda bandet. Ytterligare information om de olika banden kan hittas på [gdals hemsida](https://gdal.org/drivers/raster/sentinel2.html). Efter detta används `gdal.Open()` igen fast nu på det första datasetet. På denna filen används `.ReadAsArray()` vilket returnerar en (4, 10980, 10980)-numpyarray.
- Arrayen innehåller B4 och B8 på plats 2 respektive 3. När vi kollar på bokskogen vill vi beskära bilden för att få med just den delen. Detta görs genom att slica arrayen med `[3500:55000, 8000:10000]`.
- Efter detta används funktionen `reduce_array` i `extract_ndvi.py` som komprimerar filen genom att ta medelvärdet över n\*n-kvadrater och sparar värdena i en ny array. Utifrån våra experiment tycker vi en upplösning på max 1000\*1000 är tillräckligt för ändamålet. Vi använde därför n=3 för bilderna i bokskogen vilket ungefär motsvarar en total reducering till 700\*700 efter både beskärning och reducering. Dessa arrayer sparas sedan i filerna på formatet `.npz` med nycklarna `"red"` och `"nir"`.
- Funktionen `calc_ndvi_folder` tar namnet på ett directory med `.SAFE`-filer från bilderna i (`folder_name`), namnet på ett directory där de färdiga `.npz`- och `.png`-filerna ska sparas (`save_folder`) och ett heltal `red_num` som är hur mycket bilden ska komprimeras (n som beskrivs i föregående punkt). Directoriet med `.SAFE`-filerna bör bara innehålla dessa filer, annars kraschar programmet. Funktionen använder sedan `calc_ndvi` för att för varje bild beräkna NDVI och spara en `.png` och spara en `.npz`-fil med arrayer från det röda- och NIR-bandet. Programmet kollar om `.npz`-filen med rätt namn finns, isåfall används den istället för att läsa in orginalfilen på nytt. Detta snabbar upp programmet avsevärt och är andledningen till att `.npz`-filer används i uppgiften.  
